#!/bin/bash

set -x

curl -LsSf https://astral.sh/uv/install.sh | sh
source $HOME/.local/bin/env

git clone https://github.com/qtile/qtile
cd qtile

uv sync --python="$1" --all-extras
uv tool install .
uv tool install --reinstall ".[wayland]" # reinstall with wayland deps
uv run --python="$1" --with setuptools --directory=$(uv tool dir)/qtile/lib/python"$1"/site-packages/ $(uv tool dir)/qtile/lib/python"$1"/site-packages/libqtile/backend/wayland/cffi/build.py
ls /home/runner/.local/share/uv/tools/qtile/lib/python3.12/site-packages/libqtile/backend/wayland/ -r

# chown runner:users /home/runner/qtile -R
sudo usermod -aG video runner
